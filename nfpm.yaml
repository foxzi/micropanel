name: micropanel
arch: ${GOARCH}
platform: linux
version: ${VERSION}
release: 1
section: web
priority: optional
maintainer: MicroPanel Team
description: |
  Minimalist static hosting control panel.
  Manages static websites with Nginx, SSL certificates via Let's Encrypt,
  redirects, basic auth, and file editing.
vendor: MicroPanel
homepage: https://github.com/foxzi/micropanel
license: GPL-3.0

depends:
  - nginx
  - openssl

recommends:
  - certbot

contents:
  # Binary
  - src: bin/micropanel
    dst: /usr/bin/micropanel
    file_info:
      mode: 0755

  # Config
  - src: config.yaml.example
    dst: /etc/micropanel/config.yaml
    type: config|noreplace
    file_info:
      mode: 0640
      owner: root
      group: micropanel

  # Migrations
  - src: migrations/
    dst: /usr/share/micropanel/migrations/
    file_info:
      mode: 0644

  # Web static files
  - src: web/static/
    dst: /usr/share/micropanel/web/static/
    file_info:
      mode: 0644

  # Scripts
  - src: scripts/ssl-renew.sh
    dst: /usr/share/micropanel/scripts/ssl-renew.sh
    file_info:
      mode: 0755

  - src: scripts/setup-panel-nginx.sh
    dst: /usr/share/micropanel/scripts/setup-panel-nginx.sh
    file_info:
      mode: 0755

  - src: scripts/panel-nginx.conf.tmpl
    dst: /usr/share/micropanel/scripts/panel-nginx.conf.tmpl
    file_info:
      mode: 0644

  # Systemd services
  - src: scripts/micropanel.service
    dst: /usr/lib/systemd/system/micropanel.service
    file_info:
      mode: 0644

  - src: scripts/micropanel-ssl-renew.service
    dst: /usr/lib/systemd/system/micropanel-ssl-renew.service
    file_info:
      mode: 0644

  - src: scripts/micropanel-ssl-renew.timer
    dst: /usr/lib/systemd/system/micropanel-ssl-renew.timer
    file_info:
      mode: 0644

  # Documentation
  - src: README.md
    dst: /usr/share/doc/micropanel/README.md
    file_info:
      mode: 0644

  - src: docs/en/
    dst: /usr/share/doc/micropanel/en/
    file_info:
      mode: 0644

  - src: docs/ru/
    dst: /usr/share/doc/micropanel/ru/
    file_info:
      mode: 0644

  # Directories
  - dst: /var/lib/micropanel
    type: dir
    file_info:
      mode: 0750
      owner: micropanel
      group: micropanel

  - dst: /var/www/panel/sites
    type: dir
    file_info:
      mode: 0755
      owner: micropanel
      group: micropanel

  - dst: /etc/micropanel
    type: dir
    file_info:
      mode: 0755

scripts:
  preinstall: packaging/preinstall.sh
  postinstall: packaging/postinstall.sh
  preremove: packaging/preremove.sh

overrides:
  deb:
    depends:
      - nginx
      - openssl
      - certbot
      - python3-certbot-nginx
  rpm:
    depends:
      - nginx
      - openssl
      - certbot
      - python3-certbot-nginx
